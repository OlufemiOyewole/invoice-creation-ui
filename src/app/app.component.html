<mat-toolbar [class]="isBigScreen ? 'big-screen-toolbar' : ''"
  >Invoice #1</mat-toolbar
>

<mat-horizontal-stepper [ngClass]="{ 'big-screen': isBigScreen }">
  <mat-step
    *ngIf="!isBigScreen"
    [stepControl]="invoiceFormGroup"
    errorMessage=""
    #createOrEditStep
  >
    <form [formGroup]="invoiceFormGroup" autocomplete="off">
      <ng-template matStepLabel>{{
        createOrEditStep.interacted ? "Edit" : "Create"
      }}</ng-template>

      <mat-card class="mat-elevation-z0">
        <mat-card-header>
          <mat-card-title>Description</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <mat-form-field floatLabel="always">
            <mat-label>Billed to</mat-label>
            <input matInput formControlName="billedTo" type="text" required />
          </mat-form-field>

          <mat-form-field class="date-form-fields">
            <mat-label>Issue Date</mat-label>
            <input
              matInput
              formControlName="issueDate"
              [matDatepickerFilter]="dateFilter"
              [matDatepicker]="issueDatePicker"
              required
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="issueDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #issueDatePicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field class="date-form-fields">
            <mat-label>Due Date</mat-label>
            <input
              matInput
              formControlName="dueDate"
              [matDatepickerFilter]="dateFilter"
              [matDatepicker]="dueDatePicker"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="dueDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #dueDatePicker></mat-datepicker>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <ng-container formArrayName="lineItems">
        <ng-container *ngFor="let _ of lineItems.controls; index as i">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
            "
          >
            <button
              mat-icon-button
              style="cursor: move; margin-left: -8px"
              disableRipple
            >
              <mat-icon>drag_handle</mat-icon>
            </button>

            <mat-card
              [formGroupName]="i"
              class="line-items mat-elevation-z0"
              style="flex: 1; padding-top: 6px; padding-bottom: 0px"
            >
              <mat-card-header style="align-items: center">
                <mat-card-subtitle style="margin-bottom: 0px">
                  <mat-form-field floatLabel="never">
                    <input
                      matInput
                      formControlName="description"
                      type="text"
                      placeholder="Description"
                      required
                    />
                  </mat-form-field>
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <mat-form-field style="width: 96px" floatLabel="always">
                  <mat-label>Unit Cost</mat-label>
                  <input
                    matInput
                    formControlName="unitCost"
                    style="text-align: center"
                    placeholder="{{ 0 | currency: 'CAD' }}"
                    type="number"
                    required
                  />
                  <span
                    matPrefix
                    *ngIf="lineItems.get([i])?.get('unitCost')?.value"
                    >CA$&nbsp;</span
                  >
                </mat-form-field>

                <mat-form-field style="width: 48px" floatLabel="always">
                  <mat-label>Quantity</mat-label>
                  <input
                    matInput
                    type="number"
                    formControlName="quantity"
                    style="text-align: center"
                    required
                  />
                </mat-form-field>

                <span style="float: right; margin-bottom: 12px">
                  {{
                    lineItems.get([i])?.get("unitCost")?.value *
                      lineItems.get([i])?.get("quantity")?.value
                      | currency: "CAD"
                  }}</span
                >
              </mat-card-content>
            </mat-card>
          </div>
        </ng-container>
      </ng-container>

      <mat-card class="mat-elevation-z0 edit-summary">
        <mat-card-header>
          <mat-card-title>Summary</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <mat-list>
            <mat-divider></mat-divider>
            <mat-list-item
              ><span class="mat-body">Subtotal:</span>&nbsp;&nbsp;{{
                subtotal | currency: "CAD"
              }}</mat-list-item
            >
            <mat-divider></mat-divider>

            <mat-list-item>
              <span class="mat-body">Tax Rate:</span>&nbsp;&nbsp;

              <mat-form-field style="width: 48px" floatLabel="always">
                <mat-label></mat-label>

                <input
                  matInput
                  formControlName="taxRate"
                  type="number"
                  style="text-align: center"
                  placeholder="{{ 0 }}"
                />

                <span matSuffix *ngIf="true">&#37;</span>
              </mat-form-field>

              <span style="flex: 1"></span>

              <span
                ><span class="mat-body">Tax:</span>&nbsp;&nbsp;{{
                  taxRate | currency: "CAD"
                }}</span
              >
            </mat-list-item>

            <mat-divider></mat-divider>
            <mat-list-item
              ><span class="mat-body">Total:</span>&nbsp;&nbsp;{{
                Total | currency: "CAD"
              }}</mat-list-item
            >
            <mat-divider></mat-divider>
          </mat-list>
        </mat-card-content>

        <mat-card-actions style="margin-top: 18px" align="end">
          <button mat-raised-button color="primary" matStepperNext>
            <span>Preview</span>
            <mat-icon>arrow_right</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    </form>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>{{
      isBigScreen ? "Edit & Preview" : "Preview"
    }}</ng-template>

    <span>Edit & Preview Content</span>

    <br />
    <br />

    <div>
      <button
        mat-raised-button
        *ngIf="!isBigScreen"
        style="margin-right: 24px"
        color="primary"
        matStepperPrevious
      >
        <mat-icon>arrow_left</mat-icon>
        <span>Edit</span>
      </button>
      <button mat-raised-button color="primary" matStepperNext>
        <span>Send</span>
        <mat-icon>arrow_right</mat-icon>
      </button>
    </div>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Send</ng-template>

    <span>Send Content</span>

    <br />
    <br />

    <div>
      <button mat-raised-button color="primary" matStepperPrevious>
        <mat-icon>arrow_left</mat-icon>

        <span>Preview</span>
      </button>
    </div>
  </mat-step>
</mat-horizontal-stepper>
